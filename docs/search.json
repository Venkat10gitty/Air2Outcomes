[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Air to Outcomes: An Exploratory Analysis of Pollution and Public Health",
    "section": "",
    "text": "1 Introduction\nWe chose to focus on air pollution and respiratory health in New York City’s five boroughs because it sits at the intersection of something very concrete (daily air quality) and something deeply human (who gets sick, and where). Fine particulate matter (PM2.5) is a key pollutant that people increasingly hear about in news alerts and air-quality apps, but it is not always obvious how differences across neighborhoods or boroughs translate into actual health outcomes such as asthma and COPD deaths. In this project, We used publicly available data from the EPA, CDC WONDER, and the American Community Survey to build a borough-year panel for New York City and compare it with the rest of New York State. I’m especially interested in three questions: how PM2.5 trends differ across the five boroughs over time, whether boroughs with higher PM2.5 levels also tend to have higher asthma/COPD mortality in the same years, and which boroughs stand out as outliers once I account for population size. Our goal is not to make causal claims, but to provide an exploratory, visual story about how air quality and respiratory mortality co-evolve across the city in a way that a nontechnical reader can follow.\n\n\nCode\n# Light setup for the intro chapter\nrequired_pkgs &lt;- c(\"tidyverse\", \"lubridate\", \"janitor\", \"glue\")\n\ninstalled &lt;- rownames(installed.packages())\nfor (p in required_pkgs) {\n  if (!p %in% installed) {\n    install.packages(p)\n  }\n}\ninvisible(lapply(required_pkgs, library, character.only = TRUE))\n\n# Global options and a simple, readable theme\noptions(\n  scipen = 999,\n  dplyr.summarise.inform = FALSE\n)\n\ntheme_set(\n  theme_minimal(base_family = \"sans\") +\n    theme(\n      plot.title.position   = \"plot\",\n      plot.caption.position = \"plot\",\n      panel.grid.minor      = element_blank()\n    )\n)\n\n# Research questions for this project\nproject_questions &lt;- tibble::tribble(\n  ~id,  ~question,\n  \"Q1\", \"Do annual PM2.5 levels differ across the five NYC boroughs (Bronx, Brooklyn, Manhattan, Queens, Staten Island), and how have they changed over time?\",\n  \"Q2\", \"Are higher borough-year PM2.5 levels associated with asthma/COPD mortality?\",\n  \"Q3\", \"After normalizing by population, which boroughs are outliers, and how do they compare with the rest of New York State?\"\n)\n\nproject_questions\n\n\n# A tibble: 3 × 2\n  id    question                                                                \n  &lt;chr&gt; &lt;chr&gt;                                                                   \n1 Q1    Do annual PM2.5 levels differ across the five NYC boroughs (Bronx, Broo…\n2 Q2    Are higher borough-year PM2.5 levels associated with asthma/COPD mortal…\n3 Q3    After normalizing by population, which boroughs are outliers, and how d…",
    "crumbs": [
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>Introduction</span>"
    ]
  },
  {
    "objectID": "data.html",
    "href": "data.html",
    "title": "Data",
    "section": "",
    "text": "2.1 Description\nOur working dataset is a simple borough–year panel for the five NYC boroughs from 2010–2019. Each row represents one borough in one year and brings together annual average PM₂.₅, asthma/COPD deaths and mortality rates, plus total population and median household income. This structure lets me compare pollution and health outcomes across boroughs on the same annual scale, while still keeping enough context to interpret differences in risk.",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Data</span>"
    ]
  },
  {
    "objectID": "data.html#technical-description",
    "href": "data.html#technical-description",
    "title": "Data",
    "section": "2.2 Technical description",
    "text": "2.2 Technical description\nFor this project we combine three public data sources to build a borough–year panel for New York City and compare it to the rest of New York State. First, we use the EPA Air Quality System (AQS) annual summary data, downloaded as CSVs from the AirData portal (“annual_conc_by_monitor_YYYY.zip”), to get monitor-level annual mean PM2.5 concentrations for all New York counties and then aggregate them to county–year averages. Second, We pull asthma and COPD mortality from CDC WONDER – Underlying Cause of Death, 1999–present by running a county × year query for New York State (ICD-10 J40–J44 and J45–J46) and exporting the output as a CSV. Third, We use the American Community Survey 5-year estimates via the tidycensus R package to obtain total population and median household income for each county–year in New York. We then map the five NYC boroughs to their county FIPS codes (Bronx, Kings, New York, Queens, Richmond) and restrict the panel to an analysis window from 2010–2019. In the repo, We keep the raw EPA and WONDER CSVs under data_raw/aqs and data_raw/wonder, and We save the unmodified ACS pulls under data_raw/acs, so that anyone with an AQS key and Census API key can reproduce my pipeline. The main issues We ran into were (i) the need to manually export location-level mortality from WONDER, which breaks full automation, and (ii) slight differences in coverage across sources and years, which show up later in the missing-data diagnostics.\n\n\nCode\nrequired_pkgs &lt;- c(\n  \"tidyverse\",\n  \"lubridate\",\n  \"janitor\",\n  \"glue\",\n  \"fs\",\n  \"RAQSAPI\",\n  \"tidycensus\"\n)\n\ninstalled &lt;- rownames(installed.packages())\nfor (p in required_pkgs) {\n  if (!p %in% installed) {\n    install.packages(p)\n  }\n}\ninvisible(lapply(required_pkgs, library, character.only = TRUE))\n\noptions(\n  scipen = 999,\n  dplyr.summarise.inform = FALSE\n)\n\ntheme_set(\n  theme_minimal(base_family = \"sans\") +\n    theme(\n      plot.title.position   = \"plot\",\n      plot.caption.position = \"plot\",\n      panel.grid.minor      = element_blank()\n    )\n)\n\n\n\n\nCode\n# NYC borough ↔ county FIPS\nnyc_boroughs &lt;- tibble::tribble(\n  ~borough,        ~county_name,     ~state, ~state_fips, ~county_fips,\n  \"Bronx\",         \"Bronx\",          \"NY\",   \"36\",        \"005\",\n  \"Brooklyn\",      \"Kings\",          \"NY\",   \"36\",        \"047\",\n  \"Manhattan\",     \"New York\",       \"NY\",   \"36\",        \"061\",\n  \"Queens\",        \"Queens\",         \"NY\",   \"36\",        \"081\",\n  \"Staten Island\", \"Richmond\",       \"NY\",   \"36\",        \"085\"\n) |&gt;\n  mutate(\n    fips_state_county = paste0(state_fips, county_fips)\n  )\n\n# Analysis horizon and borough–year grid\nanalysis_years &lt;- 2010:2019\nyear_breaks &lt;- analysis_years\nyear_limits &lt;- range(analysis_years)\n\nanalysis_grid &lt;- tidyr::expand_grid(\n  fips_state_county = nyc_boroughs$fips_state_county,\n  year              = analysis_years\n) |&gt;\n  dplyr::left_join(\n    nyc_boroughs |&gt;\n      dplyr::select(fips_state_county, borough, county_name, state),\n    by = \"fips_state_county\"\n  ) |&gt;\n  dplyr::arrange(borough, year)\n\ndplyr::glimpse(analysis_grid)\n\n\nRows: 50\nColumns: 5\n$ fips_state_county &lt;chr&gt; \"36005\", \"36005\", \"36005\", \"36005\", \"36005\", \"36005\"…\n$ year              &lt;int&gt; 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018…\n$ borough           &lt;chr&gt; \"Bronx\", \"Bronx\", \"Bronx\", \"Bronx\", \"Bronx\", \"Bronx\"…\n$ county_name       &lt;chr&gt; \"Bronx\", \"Bronx\", \"Bronx\", \"Bronx\", \"Bronx\", \"Bronx\"…\n$ state             &lt;chr&gt; \"NY\", \"NY\", \"NY\", \"NY\", \"NY\", \"NY\", \"NY\", \"NY\", \"NY\"…\n\n\nThis glimpse shows the final borough–year panel I work with: each row is a NYC borough in a given year, with PM2.5, asthma/COPD mortality, and ACS population/income all merged into one place.\n\n\nCode\n# Directory layout for raw data\nfs::dir_create(\"data_raw/aqs\")\nfs::dir_create(\"data_raw/wonder\")\nfs::dir_create(\"data_raw/acs\")\n\n\n\n\nCode\n# AQS credentials:\n# I store AQS_EMAIL and AQS_KEY in my ~/.Renviron (not in the repo) so that\n# RAQSAPI picks them up via Sys.getenv(). Anyone reproducing the analysis\n# should do the same after signing up for an AQS key.\n\nSys.setenv(AQS_EMAIL = \"saivenkat1179@gmail.com\")\nSys.setenv(AQS_KEY   = \"rubyfox12\")\n\nmy_aqs_email &lt;- Sys.getenv(\"AQS_EMAIL\")\nmy_aqs_key   &lt;- Sys.getenv(\"AQS_KEY\")\n\nif (!nzchar(my_aqs_email) || !nzchar(my_aqs_key)) {\n  stop(\"AQS credentials not set. Please define AQS_EMAIL and AQS_KEY in your environment.\")\n}\n\nRAQSAPI::aqs_credentials(username = my_aqs_email, key = my_aqs_key)\n\n# Census key: also stored in ~/.Renviron via tidycensus::census_api_key()\nif (!nzchar(Sys.getenv(\"CENSUS_API_KEY\"))) {\n  stop(\"Census API key not found. Set it with tidycensus::census_api_key(..., install = TRUE).\")\n}\n\noptions(tigris_use_cache = TRUE)\n\n\n\n\nCode\n# Read EPA AirData annual_conc_by_monitor_YYYY.csv files\naqs_annual_files &lt;- fs::dir_ls(\n  \"data_raw/aqs\",\n  regexp = \"annual_conc_by_monitor_.*\\\\.csv$\"\n)\n\nif (length(aqs_annual_files) == 0L) {\n  stop(\n    \"No 'annual_conc_by_monitor_*.csv' files found in data_raw/aqs.\\n\",\n    \"Download and unzip EPA AirData annual concentration files (annual_conc_by_monitor_YYYY.zip)\\n\",\n    \"for the years you want and put the CSVs into data_raw/aqs/.\"\n  )\n}\n\nmessage(\"Reading \", length(aqs_annual_files),\n        \" EPA annual concentration file(s) from data_raw/aqs ...\")\n\naqs_annual_all_clean &lt;- purrr::map_dfr(\n  aqs_annual_files,\n  function(path) {\n    message(\"  - \", basename(path))\n    \n    dat &lt;- readr::read_csv(\n      path,\n      show_col_types = FALSE,\n      guess_max      = 100000\n    ) |&gt;\n      janitor::clean_names()\n    \n    needed &lt;- c(\n      \"state_code\",\n      \"county_code\",\n      \"site_num\",\n      \"parameter_code\",\n      \"year\",\n      \"arithmetic_mean\"\n    )\n    \n    missing &lt;- setdiff(needed, names(dat))\n    if (length(missing) &gt; 0) {\n      stop(\n        \"In file \", basename(path), \" the following needed columns are missing: \",\n        paste(missing, collapse = \", \"), \"\\n\",\n        \"Available columns are: \", paste(names(dat), collapse = \", \")\n      )\n    }\n    \n    dat |&gt;\n      dplyr::select(dplyr::all_of(needed))\n  }\n)\n\n# County–year PM2.5 for New York (state_code 36), limited to analysis_years\naqs_pm25_annual_ny_bycounty &lt;- aqs_annual_all_clean |&gt;\n  dplyr::filter(\n    state_code    == 36,\n    parameter_code == 88101\n  ) |&gt;\n  dplyr::mutate(\n    year        = as.integer(year),\n    state_code  = as.integer(state_code),\n    county_code = as.integer(county_code),\n    state_fips  = sprintf(\"%02d\", state_code),\n    county_fips = sprintf(\"%03d\", county_code),\n    fips_state_county = paste0(state_fips, county_fips)\n  ) |&gt;\n  dplyr::filter(year %in% analysis_years) |&gt;\n  dplyr::group_by(fips_state_county, year) |&gt;\n  dplyr::summarise(\n    pm25_annual = mean(arithmetic_mean, na.rm = TRUE),\n    n_monitors  = dplyr::n_distinct(site_num),\n    .groups     = \"drop\"\n  )\n\n# Restrict to NYC counties for later use\naqs_pm25_annual_nyc_bycounty &lt;- aqs_pm25_annual_ny_bycounty |&gt;\n  dplyr::filter(fips_state_county %in% nyc_boroughs$fips_state_county) |&gt;\n  dplyr::arrange(fips_state_county, year)\n\nglimpse(aqs_pm25_annual_nyc_bycounty)\n\n\nRows: 50\nColumns: 4\n$ fips_state_county &lt;chr&gt; \"36005\", \"36005\", \"36005\", \"36005\", \"36005\", \"36005\"…\n$ year              &lt;int&gt; 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018…\n$ pm25_annual       &lt;dbl&gt; 10.482199, 10.774748, 10.323052, 9.048251, 8.267042,…\n$ n_monitors        &lt;int&gt; 3, 2, 3, 2, 2, 2, 2, 2, 2, 2, 1, 1, 1, 1, 1, 1, 1, 1…\n\n\nCode\nreadr::write_rds(\n  aqs_pm25_annual_nyc_bycounty,\n  \"data_raw/aqs/aqs_pm25_annual_nyc_bycounty.rds\"\n)\n\n\nThis output verifies that the EPA AQS data correctly capture annual PM2.5 averages for the five NYC counties over my analysis window before I merge them into the borough panel.\n\n\nCode\n# CDC WONDER:\n# I cannot query county-level breakdowns via a simple API call, so I:\n# 1) Go to CDC WONDER → Underlying Cause of Death (1999–present).\n# 2) Filter to State = New York, ICD-10 J40–J44 and J45–J46, group by Year & County.\n# 3) Export the results as CSV and save it as:\n#    data_raw/wonder/wonder_ucd_asthma_copd_ny.csv\n\nwonder_file &lt;- \"data_raw/wonder/wonder_ucd_asthma_copd_ny.csv\"\n\nif (!file.exists(wonder_file)) {\n  warning(paste0(\n    \"CDC WONDER mortality file not found at: \", wonder_file, \"\\n\",\n    \"Please export a CSV from WONDER (Underlying Cause of Death, NY-only, \",\n    \"grouped by Year and County, filtered to J40–J44 and J45–J46) and save \",\n    \"it at that path.\"\n  ))\n  wonder_ucd_raw &lt;- tibble::tibble()\n} else {\n  wonder_ucd_raw &lt;- readr::read_csv(wonder_file, show_col_types = FALSE)\n}\n\nnames(wonder_ucd_raw)\n\n\n[1] \"Notes\"       \"Year\"        \"Year Code\"   \"County\"      \"County Code\"\n[6] \"Deaths\"      \"Population\"  \"Crude Rate\" \n\n\nCode\nhead(wonder_ucd_raw)\n\n\n# A tibble: 6 × 8\n  Notes  Year `Year Code` County    `County Code` Deaths Population `Crude Rate`\n  &lt;chr&gt; &lt;dbl&gt;       &lt;dbl&gt; &lt;chr&gt;             &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;       \n1 &lt;NA&gt;   1999        1999 Albany C…         36001    149     294692 50.6        \n2 &lt;NA&gt;   1999        1999 Allegany…         36003     35      49997 70.0        \n3 &lt;NA&gt;   1999        1999 Bronx Co…         36005    269    1317895 20.4        \n4 &lt;NA&gt;   1999        1999 Broome C…         36007    116     200881 57.7        \n5 &lt;NA&gt;   1999        1999 Cattarau…         36009     56      84050 66.6        \n6 &lt;NA&gt;   1999        1999 Cayuga C…         36011     57      82034 69.5        \n\n\nThis table confirms that the CDC WONDER extract has asthma/COPD deaths, population, and crude rates by county and year for just the five NYC counties.\n\n\nCode\nwonder_ucd_clean &lt;- wonder_ucd_raw |&gt;\n  janitor::clean_names() |&gt;\n  dplyr::filter(!is.na(year), !is.na(county)) |&gt;\n  dplyr::mutate(\n    year        = as.integer(year),\n    county_code = as.character(county_code),\n    fips_state_county = stringr::str_pad(county_code, width = 5, side = \"left\", pad = \"0\"),\n    deaths      = suppressWarnings(as.numeric(deaths)),\n    population  = suppressWarnings(as.numeric(population)),\n    crude_rate  = suppressWarnings(as.numeric(crude_rate))\n  )\n\nwonder_nyc &lt;- wonder_ucd_clean |&gt;\n  dplyr::filter(fips_state_county %in% nyc_boroughs$fips_state_county) |&gt;\n  dplyr::arrange(fips_state_county, year)\n\nglimpse(wonder_nyc)\n\n\nRows: 110\nColumns: 9\n$ notes             &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ year              &lt;int&gt; 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007…\n$ year_code         &lt;dbl&gt; 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007…\n$ county            &lt;chr&gt; \"Bronx County, NY\", \"Bronx County, NY\", \"Bronx Count…\n$ county_code       &lt;chr&gt; \"36005\", \"36005\", \"36005\", \"36005\", \"36005\", \"36005\"…\n$ deaths            &lt;dbl&gt; 269, 282, 287, 274, 298, 321, 295, 254, 252, 256, 29…\n$ population        &lt;dbl&gt; 1317895, 1332650, 1346555, 1358739, 1362373, 1358963…\n$ crude_rate        &lt;dbl&gt; 20.4, 21.2, 21.3, 20.2, 21.9, 23.6, 21.8, 18.8, 18.6…\n$ fips_state_county &lt;chr&gt; \"36005\", \"36005\", \"36005\", \"36005\", \"36005\", \"36005\"…\n\n\n\n\nCode\n# ACS 5-year is available only for certain years; keep the intersection\nacs_years &lt;- analysis_years[analysis_years &gt;= 2009]\n\nif (length(acs_years) == 0L) {\n  stop(\"No ACS-compatible years found in analysis_years (need &gt;= 2009).\")\n}\n\nacs_vars &lt;- c(\n  total_pop     = \"B01003_001\",\n  median_income = \"B19013_001\"\n)\n\npull_acs_ny_counties &lt;- function(years, vars) {\n  message(\"Pulling ACS 5-year data for NY counties (population + median income)...\")\n  purrr::map_dfr(\n    years,\n    function(y) {\n      message(glue::glue(\"  - Year {y}\"))\n      tidycensus::get_acs(\n        geography   = \"county\",\n        state       = \"NY\",\n        year        = y,\n        survey      = \"acs5\",\n        variables   = vars,\n        cache_table = TRUE,\n        geometry    = FALSE\n      ) |&gt;\n        dplyr::mutate(year = y)\n    }\n  )\n}\n\nacs_ny_counties_raw &lt;- pull_acs_ny_counties(acs_years, acs_vars)\n\nglimpse(acs_ny_counties_raw)\n\n\nRows: 1,240\nColumns: 6\n$ GEOID    &lt;chr&gt; \"36001\", \"36001\", \"36003\", \"36003\", \"36005\", \"36005\", \"36007\"…\n$ NAME     &lt;chr&gt; \"Albany County, New York\", \"Albany County, New York\", \"Allega…\n$ variable &lt;chr&gt; \"total_pop\", \"median_income\", \"total_pop\", \"median_income\", \"…\n$ estimate &lt;dbl&gt; 304032, 56090, 49105, 41305, 1365725, 34264, 200804, 44457, 8…\n$ moe      &lt;dbl&gt; NA, 1147, NA, 1116, NA, 474, NA, 861, NA, 1079, NA, 1409, NA,…\n$ year     &lt;int&gt; 2010, 2010, 2010, 2010, 2010, 2010, 2010, 2010, 2010, 2010, 2…\n\n\nCode\nreadr::write_rds(acs_ny_counties_raw, \"data_raw/acs/acs_ny_counties_raw.rds\")\n\n\n\n\nCode\nacs_ny_counties_clean &lt;- acs_ny_counties_raw |&gt;\n  janitor::clean_names() |&gt;\n  dplyr::mutate(\n    variable = dplyr::recode(\n      variable,\n      !!!setNames(names(acs_vars), acs_vars)\n    )\n  ) |&gt;\n  dplyr::select(geoid, year, variable, estimate, moe) |&gt;\n  tidyr::pivot_wider(\n    names_from  = variable,\n    values_from = c(estimate, moe),\n    names_glue  = \"{variable}_{.value}\"\n  ) |&gt;\n  dplyr::rename(\n    total_pop         = total_pop_estimate,\n    total_pop_moe     = total_pop_moe,\n    median_income     = median_income_estimate,\n    median_income_moe = median_income_moe\n  ) |&gt;\n  dplyr::mutate(\n    fips_state_county = geoid\n  )\n\nacs_nyc_boroughs &lt;- acs_ny_counties_clean |&gt;\n  dplyr::filter(fips_state_county %in% nyc_boroughs$fips_state_county) |&gt;\n  dplyr::arrange(fips_state_county, year)\n\nglimpse(acs_nyc_boroughs)\n\n\nRows: 50\nColumns: 7\n$ geoid             &lt;chr&gt; \"36005\", \"36005\", \"36005\", \"36005\", \"36005\", \"36005\"…\n$ year              &lt;int&gt; 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018…\n$ total_pop         &lt;dbl&gt; 1365725, 1374593, 1386364, 1397315, 1413566, 1428357…\n$ median_income     &lt;dbl&gt; 34264, 34744, 34300, 34388, 34284, 34299, 35302, 365…\n$ total_pop_moe     &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ median_income_moe &lt;dbl&gt; 474, 550, 509, 527, 461, 495, 422, 389, 525, 526, 44…\n$ fips_state_county &lt;chr&gt; \"36005\", \"36005\", \"36005\", \"36005\", \"36005\", \"36005\"…\n\n\nThis ACS table shows the 5-year estimates of total population and median household income for each NYC county, which I later use to normalize mortality and add basic socioeconomic context.\n\n\nCode\n# Merge AQS, WONDER, and ACS into a single borough–year panel\nborough_panel &lt;- analysis_grid |&gt;\n  dplyr::left_join(\n    aqs_pm25_annual_nyc_bycounty |&gt;\n      dplyr::select(fips_state_county, year, pm25_annual, n_monitors),\n    by = c(\"fips_state_county\", \"year\")\n  ) |&gt;\n  dplyr::left_join(\n    wonder_nyc |&gt;\n      dplyr::select(\n        fips_state_county,\n        year,\n        deaths,\n        population,\n        crude_rate\n      ),\n    by = c(\"fips_state_county\", \"year\")\n  ) |&gt;\n  dplyr::left_join(\n    acs_nyc_boroughs |&gt;\n      dplyr::select(\n        fips_state_county,\n        year,\n        total_pop,\n        median_income\n      ),\n    by = c(\"fips_state_county\", \"year\")\n  ) |&gt;\n  dplyr::mutate(\n    mortality_rate_per_100k = dplyr::coalesce(\n      crude_rate,\n      dplyr::if_else(\n        !is.na(deaths) & !is.na(population),\n        (deaths / population) * 100000,\n        NA_real_\n      )\n    ),\n    pm25_data_available      = !is.na(pm25_annual),\n    mortality_data_available = !is.na(mortality_rate_per_100k),\n    pop_data_available       = !is.na(total_pop)\n  )\n\nglimpse(borough_panel)\n\n\nRows: 50\nColumns: 16\n$ fips_state_county        &lt;chr&gt; \"36005\", \"36005\", \"36005\", \"36005\", \"36005\", …\n$ year                     &lt;int&gt; 2010, 2011, 2012, 2013, 2014, 2015, 2016, 201…\n$ borough                  &lt;chr&gt; \"Bronx\", \"Bronx\", \"Bronx\", \"Bronx\", \"Bronx\", …\n$ county_name              &lt;chr&gt; \"Bronx\", \"Bronx\", \"Bronx\", \"Bronx\", \"Bronx\", …\n$ state                    &lt;chr&gt; \"NY\", \"NY\", \"NY\", \"NY\", \"NY\", \"NY\", \"NY\", \"NY…\n$ pm25_annual              &lt;dbl&gt; 10.482199, 10.774748, 10.323052, 9.048251, 8.…\n$ n_monitors               &lt;int&gt; 3, 2, 3, 2, 2, 2, 2, 2, 2, 2, 1, 1, 1, 1, 1, …\n$ deaths                   &lt;dbl&gt; 342, 318, 272, 345, 313, 357, 317, 316, 356, …\n$ population               &lt;dbl&gt; 1385108, 1392002, 1408473, 1418733, 1438159, …\n$ crude_rate               &lt;dbl&gt; 24.7, 22.8, 19.3, 24.3, 21.8, 24.5, 21.8, 21.…\n$ total_pop                &lt;dbl&gt; 1365725, 1374593, 1386364, 1397315, 1413566, …\n$ median_income            &lt;dbl&gt; 34264, 34744, 34300, 34388, 34284, 34299, 353…\n$ mortality_rate_per_100k  &lt;dbl&gt; 24.7, 22.8, 19.3, 24.3, 21.8, 24.5, 21.8, 21.…\n$ pm25_data_available      &lt;lgl&gt; TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRU…\n$ mortality_data_available &lt;lgl&gt; TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRU…\n$ pop_data_available       &lt;lgl&gt; TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRU…\n\n\nCode\nreadr::write_rds(borough_panel, \"data_raw/borough_panel_nyc.rds\")\n\n\nThis is after merging AQS, WONDER, and ACS into a single borough–year panel",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Data</span>"
    ]
  },
  {
    "objectID": "data.html#missing-value-analysis",
    "href": "data.html#missing-value-analysis",
    "title": "Data",
    "section": "2.3 Missing value analysis",
    "text": "2.3 Missing value analysis\nBefore doing any analysis we wanted to be sure that the merged borough–year panel was truly usable. We therefore created simple completeness flags for each borough, year, and dataset (PM₂.₅, mortality, and population) and plotted them as a tile map. The first figure (“Where are the data complete?”) shows a solid block of “Available” tiles for every borough and every year between 2010 and 2019 across all three sources, which tells me that once we align the datasets and trim to the common window, there are no gaps at all. The second figure (“How many years of usable data do I have per borough?”) summarizes the same information numerically: each borough has ten out of ten possible years of non-missing PM₂.₅, mortality, and population values. Because the final analysis dataset is fully observed within this window, We do not need to impute or drop any borough-years due to missingness. Any limitations in the project therefore come from measurement issues (for example, how monitors are sited or how causes of death are coded), rather than from NA values in the data.\n\n\nCode\nborough_completeness &lt;- borough_panel |&gt;\n  dplyr::group_by(borough) |&gt;\n  dplyr::summarise(\n    n_years_total      = dplyr::n(),\n    n_years_pm25       = sum(pm25_data_available,      na.rm = TRUE),\n    n_years_mortality  = sum(mortality_data_available, na.rm = TRUE),\n    n_years_population = sum(pop_data_available,       na.rm = TRUE),\n    first_year         = min(year),\n    last_year          = max(year),\n    .groups            = \"drop\"\n  )\n\nborough_completeness\n\n\n# A tibble: 5 × 7\n  borough       n_years_total n_years_pm25 n_years_mortality n_years_population\n  &lt;chr&gt;                 &lt;int&gt;        &lt;int&gt;             &lt;int&gt;              &lt;int&gt;\n1 Bronx                    10           10                10                 10\n2 Brooklyn                 10           10                10                 10\n3 Manhattan                10           10                10                 10\n4 Queens                   10           10                10                 10\n5 Staten Island            10           10                10                 10\n# ℹ 2 more variables: first_year &lt;int&gt;, last_year &lt;int&gt;\n\n\n\n\nCode\nmissing_long &lt;- borough_panel |&gt;\n  dplyr::select(\n    borough,\n    year,\n    pm25       = pm25_data_available,\n    mortality  = mortality_data_available,\n    population = pop_data_available\n  ) |&gt;\n  tidyr::pivot_longer(\n    cols      = c(pm25, mortality, population),\n    names_to  = \"dataset\",\n    values_to = \"available\"\n  ) |&gt;\n  dplyr::mutate(\n    dataset = dplyr::recode(\n      dataset,\n      pm25       = \"PM2.5\",\n      mortality  = \"Mortality\",\n      population = \"Population\"\n    )\n  )\n\nggplot(missing_long,\n       aes(x = year, y = borough, fill = available)) +\n  geom_tile(color = \"white\") +\n  scale_fill_manual(\n    values = c(`TRUE` = \"steelblue4\", `FALSE` = \"grey90\"),\n    labels = c(\"Available\", \"Missing\")\n  ) +\n  scale_x_continuous(\n    breaks = year_breaks,\n    minor_breaks = NULL,\n    limits = year_limits\n  ) +\n  facet_wrap(~ dataset, ncol = 1) +\n  labs(\n    title   = \"Where are the data complete?\",\n    x       = \"Year\",\n    y       = \"Borough\",\n    fill    = \"Status\",\n    caption = \"Flags are based on merged borough panel: AQS, CDC WONDER, and ACS.\"\n  ) +\n  theme(legend.position = \"bottom\")\n\n\n\n\n\nData availability for PM2.5, mortality, and population by borough and year.\n\n\n\n\nThis plot shows that for every NYC borough, all three datasets—PM₂.₅, mortality, and population—are fully observed for each year from 2010 to 2019, so my merged borough–year panel has no gaps within the analysis window.\n\n\nCode\nborough_completeness_long &lt;- borough_completeness |&gt;\n  dplyr::select(borough, n_years_pm25, n_years_mortality, n_years_population) |&gt;\n  tidyr::pivot_longer(\n    cols      = starts_with(\"n_years_\"),\n    names_to  = \"dataset\",\n    values_to = \"n_years\"\n  ) |&gt;\n  dplyr::mutate(\n    dataset = dplyr::recode(\n      dataset,\n      n_years_pm25       = \"PM2.5\",\n      n_years_mortality  = \"Mortality\",\n      n_years_population = \"Population\"\n    )\n  )\n\nggplot(borough_completeness_long,\n       aes(x = n_years, y = reorder(borough, n_years), fill = dataset)) +\n  geom_col(position = \"dodge\") +\n  labs(\n    title = \"How many years of usable data do I have per borough?\",\n    x     = \"Number of years with non-missing values (2010–2019)\",\n    y     = \"Borough\",\n    fill  = \"Dataset\"\n  ) +\n  theme(legend.position = \"bottom\")\n\n\n\n\n\nNumber of years with non-missing PM2.5, mortality, and population per borough.\n\n\n\n\nThis bar chart confirms that each borough has ten out of ten usable years for PM₂.₅, mortality, and population, meaning I don’t need to drop or impute any borough–years due to missing values.\nSaving up the data locally, which then after can be used in results.qmd file to plot the graphs.\n\n\nCode\nfs::dir_create(\"data_clean\")\n\nreadr::write_rds(nyc_boroughs, \"data_clean/nyc_boroughs.rds\")\n\nreadr::write_rds(borough_panel, \"data_clean/borough_panel.rds\")\n\n\n# Build NY-wide county panel (all counties, not just NYC)\n\nny_counties_sf &lt;- tigris::counties(state = \"NY\", cb = TRUE, year = 2022)\n\nny_counties_names &lt;- ny_counties_sf |&gt;\n  sf::st_drop_geometry() |&gt;\n  dplyr::select(\n    fips_state_county = GEOID,\n    county_name       = NAME\n  )\n\nny_county_panel &lt;- aqs_pm25_annual_ny_bycounty |&gt;\n  dplyr::select(\n    fips_state_county,\n    year,\n    pm25_annual,\n    n_monitors\n  ) |&gt;\n  # keeping analysis years only\n  dplyr::filter(year %in% analysis_years) |&gt;\n  # joining mortality from WONDER\n  dplyr::left_join(\n    wonder_ucd_clean |&gt;\n      dplyr::select(\n        fips_state_county,\n        year,\n        deaths,\n        population,\n        crude_rate\n      ),\n    by = c(\"fips_state_county\", \"year\")\n  ) |&gt;\n  # joining ACS population + income\n  dplyr::left_join(\n    acs_ny_counties_clean |&gt;\n      dplyr::select(\n        fips_state_county,\n        year,\n        total_pop,\n        median_income\n      ),\n    by = c(\"fips_state_county\", \"year\")\n  ) |&gt;\n  # adding county names\n  dplyr::left_join(\n    ny_counties_names,\n    by = \"fips_state_county\"\n  ) |&gt;\n  # compute mortality rate and NY-C flag\n  dplyr::mutate(\n    mortality_rate_per_100k = dplyr::coalesce(\n      crude_rate,\n      dplyr::if_else(\n        !is.na(deaths) & !is.na(population),\n        (deaths / population) * 100000,\n        NA_real_\n      )\n    ),\n    is_nyc_borough = fips_state_county %in% nyc_boroughs$fips_state_county\n  )\n\nglimpse(ny_county_panel)\n\n\nRows: 148\nColumns: 12\n$ fips_state_county       &lt;chr&gt; \"36001\", \"36001\", \"36001\", \"36001\", \"36001\", \"…\n$ year                    &lt;int&gt; 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017…\n$ pm25_annual             &lt;dbl&gt; 8.089490, 8.068559, 7.329085, 6.796561, 7.0261…\n$ n_monitors              &lt;int&gt; 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 2, 3, 2, 2, 2…\n$ deaths                  &lt;dbl&gt; 135, 130, 143, 128, 117, 149, 132, 112, 122, 9…\n$ population              &lt;dbl&gt; 304204, 303565, 305455, 306945, 308171, 309381…\n$ crude_rate              &lt;dbl&gt; 44.4, 42.8, 46.8, 41.7, 38.0, 48.2, 42.7, 36.2…\n$ total_pop               &lt;dbl&gt; 304032, 303957, 304511, 305279, 306124, 307463…\n$ median_income           &lt;dbl&gt; 56090, 57715, 59359, 59394, 59940, 59887, 6090…\n$ county_name             &lt;chr&gt; \"Albany\", \"Albany\", \"Albany\", \"Albany\", \"Alban…\n$ mortality_rate_per_100k &lt;dbl&gt; 44.4, 42.8, 46.8, 41.7, 38.0, 48.2, 42.7, 36.2…\n$ is_nyc_borough          &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALS…\n\n\nCode\n# Save for results.qmd\nreadr::write_rds(ny_county_panel, \"data_clean/ny_county_panel.rds\")",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Data</span>"
    ]
  },
  {
    "objectID": "results.html",
    "href": "results.html",
    "title": "3  Results",
    "section": "",
    "text": "3.1 Do annual PM2.5 levels differ across boroughs, and how have they changed over time?\nAcross 2010–2019, We see a gentle downward drift in annual PM₂.₅ in every New York City borough, with differences between boroughs narrowing over time. Asthma and COPD mortality move more erratically from year to year, but boroughs with persistently higher pollution often appear toward the upper end of the mortality range, especially the Bronx, although the relationship is not perfectly one-to-one.\nWhen we compare New York City to the rest of New York State, the boroughs generally sit at or slightly above the statewide PM₂.₅ distribution, while their mortality experience is more mixed. The Bronx, in particular, stands out as a borough that often combines relatively poor air quality with above-average asthma/COPD mortality.\nCode\nggplot(borough_panel_plot, aes(x = year, y = pm25_annual, color = borough)) +\n  geom_line(linewidth = 0.9, alpha = 0.9) +\n  geom_point(size = 1.8) +\n  scale_x_continuous(\n    breaks = year_breaks,\n    minor_breaks = NULL,\n    limits = year_limits\n  ) +\n  labs(\n    title    = \"Annual PM2.5 levels in NYC boroughs\",\n    x        = \"Year\",\n    y        = \"Annual mean PM2.5 (µg/m³)\",\n    color    = \"Borough\",\n    caption  = \"PM2.5 annual averages from EPA AQS annual summary data; borough = county.\"\n  ) +\n  theme(legend.position = \"bottom\")\nThe time-series plot shows that all five boroughs live in a fairly tight PM₂.₅ band and have been drifting downward over the decade, reflecting broad regional improvements in air quality. While there are some small gaps between boroughs in individual years, those differences are modest relative to the overall downward trend.\nCode\nlibrary(sf)\nlibrary(tigris)\n\noptions(tigris_use_cache = TRUE)\n\nny_counties_sf &lt;- tigris::counties(\n  state = \"NY\",\n  cb    = TRUE,\n  year  = 2022\n)\n\nnyc_boroughs_sf &lt;- ny_counties_sf |&gt;\n  dplyr::filter(GEOID %in% nyc_boroughs$fips_state_county)\n\nmap_year &lt;- max(borough_panel_plot$year, na.rm = TRUE)\n\nborough_for_map &lt;- borough_panel_plot |&gt;\n  dplyr::filter(year == map_year) |&gt;\n  dplyr::select(\n    fips_state_county,\n    borough,\n    year,\n    pm25_annual,\n    mortality_rate_per_100k\n  )\n\nnyc_boroughs_mapdata &lt;- nyc_boroughs_sf |&gt;\n  dplyr::left_join(\n    borough_for_map,\n    by = c(\"GEOID\" = \"fips_state_county\")\n  )\nggplot(nyc_boroughs_mapdata) +\n  geom_sf(aes(fill = pm25_annual), color = \"grey40\", linewidth = 0.4) +\n  scale_fill_viridis_c(option = \"C\", na.value = \"grey90\") +\n  labs(\n    title   = paste0(\"Annual PM2.5 by NYC borough (\", map_year, \")\"),\n    fill    = \"PM2.5 (µg/m³)\",\n    caption = \"PM2.5 from EPA AQS annual summary; borough polygons from tigris counties.\"\n  ) +\n  theme(\n    axis.text  = element_blank(),\n    axis.title = element_blank()\n  )\nFor the choropleth maps we focus on 2019, which is the last year in our analysis window for which we have complete information from all three data sources (EPA AQS for PM₂.₅, CDC WONDER for asthma/COPD mortality, and ACS for population/income) for all five NYC boroughs. Earlier years have gaps (e.g., missing mortality or ACS values for one or more boroughs), which would make a borough-by-borough map misleading. We therefore use 2019 as a clean, up-to-date snapshot year and rely on the time-series plots in the previous sections to show how these patterns evolve over time.\nCode\nny_pm25_median &lt;- ny_county_panel |&gt;\n  dplyr::filter(!is.na(pm25_annual)) |&gt;\n  dplyr::group_by(year) |&gt;\n  dplyr::summarise(\n    state_median_pm25 = stats::median(pm25_annual, na.rm = TRUE),\n    .groups = \"drop\"\n  )\n\npm25_dumbbell &lt;- borough_panel_plot |&gt;\n  dplyr::select(borough, year, pm25_annual) |&gt;\n  dplyr::left_join(ny_pm25_median, by = \"year\")\n\nggplot(pm25_dumbbell,\n       aes(y = year)) +\n  geom_segment(\n    aes(\n      x    = state_median_pm25,\n      xend = pm25_annual\n    ),\n    color     = \"grey70\",\n    linewidth = 0.8\n  ) +\n  geom_point(\n    aes(x = state_median_pm25),\n    color = \"black\",\n    size  = 2\n  ) +\n  geom_point(\n    aes(x = pm25_annual, color = borough),\n    size = 2\n  ) +\n  scale_y_continuous(breaks = analysis_years) +\n  labs(\n    title    = \"Borough vs statewide median PM2.5\",\n    subtitle = \"Black dot = NY-state median; coloured dot = borough value\",\n    x        = \"PM2.5 (µg/m³)\",\n    y        = \"Year\",\n    color    = \"Borough\"\n  ) +\n  facet_wrap(~ borough, ncol = 2) +\n  theme(legend.position = \"bottom\")\nComparing boroughs only to one another doesn’t tell us how they compare to the rest of New York State. This dumbbell plot anchors each year at the statewide median PM2.5 and shows how far each borough lies above or below it, making the Bronx and Manhattan’s persistently higher pollution stand out.\nCode\nif (!\"GGally\" %in% rownames(installed.packages())) {\n  install.packages(\"GGally\")\n}\nlibrary(GGally)\n\npar_data &lt;- borough_panel_plot %&gt;%\n  dplyr::select(\n    borough, year,\n    pm25_annual,\n    mortality_rate_per_100k,\n    total_pop,\n    median_income\n  )\n\nGGally::ggparcoord(\n  data       = par_data,\n  columns    = c(\n    which(names(par_data) == \"pm25_annual\"),\n    which(names(par_data) == \"mortality_rate_per_100k\"),\n    which(names(par_data) == \"total_pop\"),\n    which(names(par_data) == \"median_income\")\n  ),\n  groupColumn = which(names(par_data) == \"borough\"),\n  scale       = \"uniminmax\",\n  showPoints  = TRUE,\n  alphaLines  = 0.7\n) +\n  scale_color_brewer(palette = \"Set1\") +\n  labs(\n    title = \"Parallel coordinates of borough-year profiles\",\n    x     = \"Metric\",\n    y     = \"Rescaled value (0–1)\",\n    color = \"Borough\"\n  ) +\n  theme(legend.position = \"bottom\")\nThe previous plots focused on PM2.5 alone. To see the broader context, we plot PM2.5, mortality, population, and income together in a parallel-coordinates plot. This shows that the boroughs with higher pollution also tend to be denser and lower-income, hinting at structural differences behind exposure and health burden.\nCode\npca_input &lt;- borough_panel_plot |&gt;\n  dplyr::select(\n    borough,\n    year,\n    pm25_annual,\n    mortality_rate_per_100k,\n    total_pop,\n    median_income\n  ) %&gt;%\n  tidyr::drop_na()\n\npca_numeric &lt;- pca_input |&gt;\n  dplyr::select(pm25_annual, mortality_rate_per_100k, total_pop, median_income)\n\npca_fit &lt;- prcomp(pca_numeric, scale. = TRUE)\n\nscores &lt;- as.data.frame(pca_fit$x) |&gt;\n  dplyr::mutate(\n    borough = pca_input$borough,\n    year    = pca_input$year,\n    year_f  = factor(pca_input$year)\n  )\n\nloadings &lt;- as.data.frame(pca_fit$rotation[, 1:2])\nloadings$var &lt;- rownames(loadings)\n\narrow_scale &lt;- 2.5\nloadings &lt;- loadings |&gt;\n  dplyr::mutate(\n    PC1_arrow = PC1 * arrow_scale,\n    PC2_arrow = PC2 * arrow_scale\n  )\n\nggplot() +\n  geom_point(\n    data  = scores,\n    aes(x = PC1, y = PC2, color = borough, shape = year_f),\n    alpha = 0.85,\n    size  = 2.3\n  ) +\n  geom_segment(\n    data = loadings,\n    aes(x = 0, y = 0, xend = PC1_arrow, yend = PC2_arrow),\n    arrow = arrow(length = unit(0.2, \"cm\")),\n    linewidth = 0.7,\n    color = \"grey30\"\n  ) +\n  geom_text(\n    data = loadings,\n    aes(x = PC1_arrow, y = PC2_arrow, label = var),\n    hjust = 0.5,\n    vjust = -0.5,\n    size  = 3.3\n  ) +\n  scale_color_brewer(palette = \"Set1\") +\n  labs(\n    title    = \"PCA biplot of NYC borough-year profiles\",\n    subtitle = \"Points: borough-years; arrows: loadings of PM2.5, mortality, population, income\",\n    x        = \"PC1\",\n    y        = \"PC2\",\n    color    = \"Borough\",\n    shape    = \"Year\"\n  ) +\n  theme(\n    legend.position = \"bottom\",\n    panel.grid      = element_line(color = \"grey90\")\n  )\nParallel coordinates can become visually dense, so we also compress the same four variables into two principal components. The PCA biplot shows how borough-years cluster and which variables drive separation; pollution and mortality load together, while higher income points in an opposite direction.",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Results</span>"
    ]
  },
  {
    "objectID": "results.html#are-higher-pm2.5-levels-associated-with-asthmacopd-mortality",
    "href": "results.html#are-higher-pm2.5-levels-associated-with-asthmacopd-mortality",
    "title": "3  Results",
    "section": "3.2 Are higher PM2.5 levels associated with asthma/COPD mortality?",
    "text": "3.2 Are higher PM2.5 levels associated with asthma/COPD mortality?\n\n\nCode\nggplot(borough_panel_plot, aes(x = year, y = mortality_rate_per_100k, color = borough)) +\n  geom_line(linewidth = 0.9, alpha = 0.9) +\n  geom_point(size = 1.8) +\n  scale_x_continuous(\n    breaks = year_breaks,\n    minor_breaks = NULL,\n    limits = year_limits\n  ) +\n  labs(\n    title   = \"Asthma/COPD mortality in NYC boroughs\",\n    x       = \"Year\",\n    y       = \"Mortality rate per 100,000\",\n    color   = \"Borough\",\n    caption = \"Mortality from CDC WONDER (J40–J46); crude or derived rate per 100k.\"\n  ) +\n  theme(legend.position = \"bottom\")\n\n\n\n\n\n\n\n\n\nBefore linking pollution and health directly, we mirror the PM₂.₅ time series with a matching time series for asthma/COPD mortality. Mortality fluctuates from year to year, with some hints of improvement in a few boroughs. However, the Bronx – and to a lesser extent Brooklyn – remain consistently toward the high end of the range, suggesting uneven health gains.\n\n\nCode\nggplot(\n  borough_panel_plot,\n  aes(x = pm25_annual, y = mortality_rate_per_100k)\n) +\n  geom_point(size = 2, alpha = 0.8, color = \"steelblue4\") +\n  geom_smooth(\n    method   = \"loess\",\n    se       = TRUE,\n    linewidth= 0.9,\n    span     = 0.9,\n    color    = \"black\"\n  ) +\n  labs(\n    title = \"PM2.5 vs asthma/COPD mortality by borough\",\n    x     = \"Annual PM2.5 (µg/m³)\",\n    y     = \"Mortality rate per 100,000\"\n  ) +\n  facet_wrap(~ borough, ncol = 2) +\n  theme(legend.position = \"none\")\n\n\n\n\n\n\n\n\n\nTime series don’t show how PM2.5 and mortality line up in the same year. By faceting a scatterplot of mortality vs PM2.5 for each borough, we see that some boroughs (notably the Bronx) cluster in the higher-pollution, higher-mortality corner, while Staten Island tends to occupy the lower part of the space.\n\n\nCode\nborough_summary &lt;- borough_panel_plot |&gt;\n  dplyr::group_by(borough) |&gt;\n  dplyr::summarise(\n    years_covered       = paste0(min(year), \"–\", max(year)),\n    mean_pm25           = mean(pm25_annual, na.rm = TRUE),\n    mean_mortality_100k = mean(mortality_rate_per_100k, na.rm = TRUE),\n    pm25_sd             = stats::sd(pm25_annual, na.rm = TRUE),\n    mortality_sd        = stats::sd(mortality_rate_per_100k, na.rm = TRUE),\n    pm25_mort_cor       = if (dplyr::n() &gt;= 3) {\n      stats::cor(pm25_annual, mortality_rate_per_100k, use = \"complete.obs\")\n    } else {\n      NA_real_\n    },\n    .groups = \"drop\"\n  ) |&gt;\n  dplyr::arrange(dplyr::desc(mean_pm25))\n\nborough_summary_long &lt;- borough_summary %&gt;%\n  dplyr::select(borough, mean_pm25, mean_mortality_100k) %&gt;%\n  tidyr::pivot_longer(\n    cols      = c(mean_pm25, mean_mortality_100k),\n    names_to  = \"metric\",\n    values_to = \"value\"\n  ) %&gt;%\n  dplyr::mutate(\n    metric = dplyr::recode(\n      metric,\n      mean_pm25           = \"PM2.5 (µg/m³)\",\n      mean_mortality_100k = \"Deaths per 100k\"\n    )\n  )\n\nggplot(borough_summary_long,\n       aes(x = value, y = reorder(borough, value), color = metric)) +\n  geom_point(size = 3) +\n  facet_wrap(~ metric, scales = \"free_x\") +\n  labs(\n    title = \"Average pollution & asthma/COPD mortality by borough\",\n    x     = NULL,\n    y     = \"Borough\",\n    color = \"Metric\"\n  ) +\n  theme(legend.position = \"none\")\n\n\n\n\n\n\n\n\n\nCode\n# Borough Profile: Z-Scores for PM₂.₅ vs Mortality\n\nborough_profile &lt;- borough_summary %&gt;%\n  dplyr::mutate(\n    pm25_z = (mean_pm25 - mean(mean_pm25, na.rm = TRUE)) /\n             stats::sd(mean_pm25, na.rm = TRUE),\n    mort_z = (mean_mortality_100k - mean(mean_mortality_100k, na.rm = TRUE)) /\n             stats::sd(mean_mortality_100k, na.rm = TRUE)\n  )\n\nggplot(borough_profile, aes(y = reorder(borough, mort_z))) +\n  geom_segment(\n    aes(x = pm25_z, xend = mort_z, yend = borough),\n    color = \"grey60\",\n    linewidth = 0.8\n  ) +\n  geom_point(aes(x = pm25_z), color = \"steelblue4\", size = 3) +\n  geom_point(aes(x = mort_z), color = \"firebrick3\", size = 3) +\n  labs(\n    title    = \"Borough profiles: pollution vs asthma/COPD mortality\",\n    subtitle = \"Values are standardised (z-scores) across boroughs\",\n    x        = \"Standardised value (z-score)\",\n    y        = \"Borough\"\n  ) +\n  annotate(\n    \"text\",\n    x = min(borough_profile$pm25_z, borough_profile$mort_z, na.rm = TRUE),\n    y = Inf,\n    label = \"● PM2.5      ● Mortality\",\n    hjust = 0,\n    vjust = 1.5,\n    size  = 3\n  )\n\n\n\n\n\n\n\n\n\nThe dot plot summarises the decade in two numbers per borough and makes the contrast clearer: boroughs with the worst air also tend to have the highest average mortality. The pattern is not perfectly one-to-one, but the same boroughs repeatedly appear toward the high-risk end of both scales.\n\n\nCode\nif (!\"ggdist\" %in% rownames(installed.packages())) {\n  install.packages(\"ggdist\")\n}\nlibrary(ggdist)\n\nyear_min &lt;- min(borough_panel_plot$year, na.rm = TRUE)\nyear_max &lt;- max(borough_panel_plot$year, na.rm = TRUE)\nmid_cut  &lt;- floor((year_min + year_max) / 2)\n\nmort_rain &lt;- borough_panel_plot |&gt;\n  dplyr::mutate(\n    period = dplyr::case_when(\n      year &lt;= mid_cut ~ paste0(year_min, \"–\", mid_cut),\n      TRUE            ~ paste0(mid_cut + 1, \"–\", year_max)\n    )\n  )\n\nggplot(\n  mort_rain,\n  aes(x = mortality_rate_per_100k, y = borough, fill = period, color = period)\n) +\n  stat_halfeye(\n    orientation   = \"horizontal\",\n    alpha         = 0.6,\n    point_interval= \"median_qi\"\n  ) +\n  geom_jitter(\n    height = 0.1,\n    width  = 0,\n    alpha  = 0.7,\n    size   = 1.5\n  ) +\n  facet_wrap(~ period, ncol = 1) +\n  labs(\n    title   = \"Asthma/COPD mortality by borough over time\",\n    x       = \"Deaths per 100k\",\n    y       = \"Borough\",\n    fill    = \"Period\",\n    color   = \"Period\"\n  ) +\n  theme(legend.position = \"none\")\n\n\n\n\n\n\n\n\n\nThe scatterplots don’t easily show how the distribution of mortality changed over time within each borough. Splitting the years into early vs late periods, the raincloud plots reveal both shifts in median mortality and changes in spread, with some boroughs showing more consistent improvement than others.\n\n\nCode\ndensity_data &lt;- ny_counties_sf %&gt;%\n  dplyr::mutate(\n    area_km2 = as.numeric(sf::st_area(geometry)) / 1e6\n  ) %&gt;%\n  sf::st_drop_geometry() %&gt;%\n  dplyr::select(\n    fips_state_county = GEOID,\n    area_km2\n  )\n\nny_model_data &lt;- ny_county_panel |&gt;\n  dplyr::filter(\n    year %in% analysis_years,\n    !is.na(pm25_annual),\n    !is.na(mortality_rate_per_100k),\n    !is.na(median_income)\n  ) %&gt;%\n  dplyr::left_join(density_data, by = \"fips_state_county\") %&gt;%\n  dplyr::mutate(\n    pop_density = total_pop / area_km2\n  ) %&gt;%\n  dplyr::filter(\n    !is.na(pop_density),\n    is.finite(pop_density)\n  )\n\nlm_ny &lt;- lm(\n  mortality_rate_per_100k ~ pm25_annual + median_income + pop_density,\n  data = ny_model_data\n)\n\nny_model_data &lt;- ny_model_data |&gt;\n  dplyr::mutate(\n    partial_resid_pm25 =\n      resid(lm_ny) + coef(lm_ny)[[\"pm25_annual\"]] * pm25_annual\n  )\n\nggplot(ny_model_data, aes(x = pm25_annual, y = partial_resid_pm25)) +\n  geom_point(alpha = 0.6, size = 1.5) +\n  geom_smooth(\n    method   = \"loess\",\n    se       = TRUE,\n    linewidth= 0.9,\n    color    = \"steelblue4\"\n  ) +\n  labs(\n    title    = \"Partial residuals for PM2.5\",\n    subtitle = \"From model: mortality ~ PM2.5 + income + population density\",\n    x        = \"PM2.5 (µg/m³)\",\n    y        = \"Partial residual (mortality, adjusted)\"\n  )\n\n\n\n\n\n\n\n\n\nAll previous associations between PM2.5 and mortality were bivariate. Here we fit a simple county-level model that includes median income and population density, then plot partial residuals for PM2.5. The partial residual plot suggests that counties with higher PM₂.₅ also tend to have higher mortality even after adjusting for income and population density, though the relationship is noisy and should be interpreted as exploratory rather than causal.",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Results</span>"
    ]
  },
  {
    "objectID": "results.html#after-normalizing-by-population-which-boroughs-are-outliers-vs-the-rest-of-ny-state",
    "href": "results.html#after-normalizing-by-population-which-boroughs-are-outliers-vs-the-rest-of-ny-state",
    "title": "3  Results",
    "section": "3.3 After normalizing by population, which boroughs are outliers vs the rest of NY State?",
    "text": "3.3 After normalizing by population, which boroughs are outliers vs the rest of NY State?\n\n\nCode\nif (!\"ggridges\" %in% rownames(installed.packages())) {\n  install.packages(\"ggridges\")\n}\nlibrary(ggridges)\n\npm_ridge_data &lt;- ny_county_panel |&gt;\n  dplyr::filter(!is.na(pm25_annual))\n\nggplot(pm_ridge_data, aes(x = pm25_annual, y = factor(year))) +\n  ggridges::geom_density_ridges(\n    rel_min_height = 0.01,\n    fill           = \"grey80\",\n    color          = \"grey40\",\n    alpha          = 0.8\n  ) +\n  geom_point(\n    data = pm_ridge_data %&gt;% dplyr::filter(is_nyc_borough),\n    aes(x = pm25_annual, y = factor(year)),\n    color    = \"red\",\n    size     = 1.6,\n    alpha    = 0.9,\n    position = position_nudge(y = -0.05)\n  ) +\n  labs(\n    title    = \"NYC boroughs vs statewide PM2.5 distribution\",\n    subtitle = \"Ridges: all NY counties; red points: NYC boroughs\",\n    x        = \"Annual mean PM2.5 (µg/m³)\",\n    y        = \"Year\",\n    caption  = \"EPA AQS annual summary data, county-level; boroughs are NYC counties.\"\n  )\n\n\n\n\n\n\n\n\n\nTo see how NYC compares to the full statewide distribution, we plot ridges of county-level PM2.5 by year, overlaying NYC boroughs as red points. The boroughs rarely sit at the low end; in many years they lie clearly on the higher side of the statewide distribution.\n\n\nCode\nmort_ridge_data &lt;- ny_county_panel |&gt;\n  dplyr::filter(!is.na(mortality_rate_per_100k))\n\nggplot(mort_ridge_data, aes(x = mortality_rate_per_100k, y = factor(year))) +\n  ggridges::geom_density_ridges(\n    rel_min_height = 0.01,\n    fill           = \"grey80\",\n    color          = \"grey40\",\n    alpha          = 0.8\n  ) +\n  geom_point(\n    data = mort_ridge_data %&gt;% dplyr::filter(is_nyc_borough),\n    aes(x = mortality_rate_per_100k, y = factor(year)),\n    color    = \"red\",\n    size     = 1.6,\n    alpha    = 0.9,\n    position = position_nudge(y = -0.05)\n  ) +\n  labs(\n    title    = \"NYC boroughs vs statewide asthma/COPD mortality distribution\",\n    subtitle = \"Ridges: all NY counties; red points: NYC boroughs\",\n    x        = \"Mortality rate per 100,000\",\n    y        = \"Year\",\n    caption  = \"CDC WONDER J40–J46 mortality; ACS population for rates where needed.\"\n  )\n\n\n\n\n\n\n\n\n\nWe then repeat the ridge view for asthma/COPD mortality. The Bronx especially tends to lie in the upper part of the statewide mortality distribution, suggesting that its respiratory burden is high not only relative to other boroughs but also relative to other NY counties.\n\n\nCode\nstate_medians &lt;- ny_county_panel |&gt;\n  dplyr::filter(\n    year %in% analysis_years,\n    !is.na(pm25_annual),\n    !is.na(mortality_rate_per_100k)\n  ) %&gt;%\n  dplyr::group_by(year) %&gt;%\n  dplyr::summarise(\n    state_med_pm25  = stats::median(pm25_annual, na.rm = TRUE),\n    state_med_mort  = stats::median(mortality_rate_per_100k, na.rm = TRUE),\n    .groups         = \"drop\"\n  )\n\nboro_diff &lt;- borough_panel_plot |&gt;\n  dplyr::left_join(state_medians, by = \"year\") |&gt;\n  dplyr::mutate(\n    diff_pm25 = pm25_annual - state_med_pm25,\n    diff_mort = mortality_rate_per_100k - state_med_mort\n  ) |&gt;\n  tidyr::pivot_longer(\n    cols      = c(diff_pm25, diff_mort),\n    names_to  = \"metric\",\n    values_to = \"diff\"\n  ) |&gt;\n  dplyr::mutate(\n    metric = dplyr::recode(\n      metric,\n      diff_pm25 = \"PM2.5 difference (borough - state median)\",\n      diff_mort = \"Mortality difference (borough - state median)\"\n    )\n  )\n\nggplot(\n  boro_diff,\n  aes(x = diff, y = reorder(borough, diff))\n) +\n  geom_vline(xintercept = 0, color = \"grey80\") +\n  geom_point(aes(color = year), size = 2, alpha = 0.9) +\n  facet_wrap(~ metric, scales = \"free_x\") +\n  scale_color_viridis_c() +\n  labs(\n    title   = \"Cleveland dot plots: borough deviations from statewide medians\",\n    x       = \"Difference from NY-state median\",\n    y       = \"Borough\",\n    color   = \"Year\"\n  ) +\n  theme(legend.position = \"bottom\")\n\n\n\n\n\n\n\n\n\nRidge plots show where boroughs sit in the overall distribution but not by how much they differ from a “typical” county. The Cleveland dot plots recenter each year on the statewide median and show borough-level deviations for both PM2.5 and mortality, highlighting which boroughs are systematically above or below the NY median\n\n\nCode\n# 7D. Annual Change: Slope Chart\n\n#| label: borough-trends\n#| message: false\n#| warning: false\n\nborough_trends &lt;- borough_panel_plot |&gt;\n  dplyr::group_by(borough) |&gt;\n  tidyr::nest() |&gt;\n  dplyr::mutate(\n    lm_pm25 = purrr::map(data, ~ lm(pm25_annual ~ year, data = .x)),\n    lm_mort = purrr::map(data, ~ lm(mortality_rate_per_100k ~ year, data = .x)),\n    pm25_slope = purrr::map_dbl(lm_pm25, ~ coef(.x)[[\"year\"]]),\n    mort_slope = purrr::map_dbl(lm_mort, ~ coef(.x)[[\"year\"]])\n  ) |&gt;\n  dplyr::select(borough, pm25_slope, mort_slope)\n\nborough_trends\n\n\n# A tibble: 5 × 3\n# Groups:   borough [5]\n  borough       pm25_slope mort_slope\n  &lt;chr&gt;              &lt;dbl&gt;      &lt;dbl&gt;\n1 Bronx             -0.419    0.0503 \n2 Brooklyn          -0.314   -0.0661 \n3 Manhattan         -0.326   -0.00182\n4 Queens            -0.321    0.0576 \n5 Staten Island     -0.216    0.364  \n\n\nCode\nslopes_long &lt;- borough_trends %&gt;%\n  tidyr::pivot_longer(\n    cols      = c(pm25_slope, mort_slope),\n    names_to  = \"metric\",\n    values_to = \"slope\"\n  ) %&gt;%\n  dplyr::mutate(\n    metric = dplyr::recode(\n      metric,\n      pm25_slope = \"PM2.5 (µg/m³ per year)\",\n      mort_slope = \"Deaths per 100k per year\"\n    )\n  )\n\nggplot(slopes_long,\n       aes(x = slope, y = reorder(borough, slope), fill = slope &lt; 0)) +\n  geom_vline(xintercept = 0, color = \"grey80\") +\n  geom_col(alpha = 0.8) +\n  facet_wrap(~ metric, scales = \"free_x\") +\n  scale_fill_manual(values = c(\"TRUE\" = \"steelblue4\", \"FALSE\" = \"firebrick3\"), guide = \"none\") +\n  labs(\n    title = \"Estimated annual change in PM2.5 and mortality\",\n    x     = \"Slope (per year)\",\n    y     = \"Borough\"\n  )\n\n\n\n\n\n\n\n\n\n\n\nCode\nif (!\"biscale\" %in% rownames(installed.packages())) {\n  install.packages(\"biscale\")\n}\nlibrary(biscale)\n\nboro_bivar &lt;- bi_class(\n  borough_panel_plot,\n  x     = pm25_annual,\n  y     = mortality_rate_per_100k,\n  style = \"quantile\",\n  dim   = 3\n)\n\nggplot(boro_bivar, aes(x = year, y = borough, fill = bi_class)) +\n  geom_tile(color = \"white\", linewidth = 0.4) +\n  bi_scale_fill(pal = \"DkViolet\", dim = 3) +\n  scale_x_continuous(breaks = analysis_years) +\n  labs(\n    title   = \"Bivariate view of PM2.5 and asthma/COPD mortality\",\n    x       = \"Year\",\n    y       = \"Borough\"\n  ) +\n  theme(legend.position = \"none\")\n\n\n\n\n\n\n\n\n\n\n\nCode\nny_zscores &lt;- ny_county_panel |&gt;\n  dplyr::filter(\n    !is.na(pm25_annual),\n    !is.na(mortality_rate_per_100k)\n  ) |&gt;\n  dplyr::group_by(year) |&gt;\n  dplyr::mutate(\n    pm25_z = (pm25_annual - mean(pm25_annual, na.rm = TRUE)) /\n             stats::sd(pm25_annual,  na.rm = TRUE),\n    mort_z = (mortality_rate_per_100k - mean(mortality_rate_per_100k, na.rm = TRUE)) /\n             stats::sd(mortality_rate_per_100k,  na.rm = TRUE)\n  ) |&gt;\n  dplyr::ungroup() |&gt;\n  dplyr::filter(fips_state_county %in% nyc_boroughs$fips_state_county)\n\nnyc_z_long &lt;- ny_zscores |&gt;\n  dplyr::select(year, county_name, pm25_z, mort_z) |&gt;\n  tidyr::pivot_longer(\n    cols      = c(pm25_z, mort_z),\n    names_to  = \"metric\",\n    values_to = \"z\"\n  ) |&gt;\n  dplyr::mutate(\n    metric = dplyr::recode(\n      metric,\n      pm25_z = \"PM2.5 z-score\",\n      mort_z = \"Mortality z-score\"\n    )\n  )\n\n#| fig-cap: \"NYC boroughs relative to the statewide distribution (z-scores).\"\n\nggplot(nyc_z_long,\n       aes(x = factor(year), y = county_name, fill = z)) +\n  geom_tile(color = \"white\") +\n  facet_wrap(~ metric) +\n  scale_fill_gradient2(\n    low  = \"steelblue4\",\n    mid  = \"white\",\n    high = \"firebrick3\",\n    midpoint = 0\n  ) +\n  labs(\n    title    = \"NYC boroughs within the New York county distribution\",\n    subtitle = \"Positive values indicate above-average PM2.5 or mortality relative to all NY counties\",\n    x        = \"Year\",\n    y        = \"Borough\",\n    fill     = \"z-score\"\n  )\n\n\n\n\n\n\n\n\n\nThe z-score heatmap translates “above or below average” into color: warm tones mark years when a borough is well above the statewide mean, cool tones when it is well below. A few boroughs consistently light up on both the PM₂.₅ and mortality panels, reinforcing the idea that the same communities are repeatedly exposed to higher risk.",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Results</span>"
    ]
  },
  {
    "objectID": "conclusion.html",
    "href": "conclusion.html",
    "title": "4  Conclusion",
    "section": "",
    "text": "Overall, our exploration suggests that while PM2.5 levels have dropped across all five NYC boroughs since 2010, the benefits have not translated into equally large improvements in asthma/COPD mortality, which especially in the Bronx, which consistently sits near the top of the statewide distribution for deaths even when its pollution is no longer an extreme outlier. By putting NYC in the context of all New York State counties, we saw that the boroughs are “middle of the pack” for PM2.5 but often above-average for mortality, hinting that factors like population density, income, housing, or access to care likely matter as much as small remaining differences in ambient PM2.5. At the same time, our statewide regression and partial-residual view suggest that, even after adjusting for median income and population density, higher PM2.5 is still modestly associated with higher mortality which is more as one contributor among many than a single dominant driver. Methodologically, this project taught us how fragile “clean” datasets can be: aligning three separate systems (EPA AQS, CDC WONDER, ACS) at the county–year level required a lot of FIPS wrangling, manual WONDER exports, and decisions like restricting our main analysis window to 2010–2019 and using 2019 as the only map year with fully complete data. These choices are limitations: we work at county (borough) resolution rather than neighborhoods, we rely mostly on crude rates, and we do not control for age structure, smoking prevalence, housing conditions, or within-borough heterogeneity, so we avoid making any causal claims. A natural next step would be to move to age-adjusted rates and finer spatial units (ZIP codes or census tracts), add other pollutants and weather variables, and link in more detailed socioeconomic and healthcare access measures to see which combinations best explain the persistent excess mortality in places like the Bronx. Finally, on the workflow side, we learned the value of building a reproducible panel early, checking completeness before graphing, and being willing to drop “fancy” ideas that were not feasible under the time and data constraints the lessons that will shape how we scope and document data projects going forward.",
    "crumbs": [
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>Conclusion</span>"
    ]
  }
]